import{bD as xt,N as pt,bE as G,bF as Ft,R as Y,az as lt,r as b,j as h,B as K,u as vt,bG as _t,bH as Bt,bI as Dt,bJ as Rt,bK as ht,bs as Ut,bL as Lt,h as zt,S as Vt,H as Zt,D as ct,b0 as Kt,aS as mt,v as qt,a0 as Qt,a1 as Jt,aL as Xt,a9 as te,a3 as ee}from"./index-CYAzAkrO.js";import{g as ne}from"./colors-BOxRRE_E.js";let yt;function se(){return yt||(yt=new Image,yt.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),yt}var It={exports:{}};(function(u,o){(function(t,n){u.exports=n()})(xt,function(){return function(t,n){var r=n.prototype,f=r.format;r.format=function(a){var s=this,e=this.$locale();if(!this.isValid())return f.bind(this)(a);var i=this.$utils(),c=(a||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(m){switch(m){case"Q":return Math.ceil((s.$M+1)/3);case"Do":return e.ordinal(s.$D);case"gggg":return s.weekYear();case"GGGG":return s.isoWeekYear();case"wo":return e.ordinal(s.week(),"W");case"w":case"ww":return i.s(s.week(),m==="w"?1:2,"0");case"W":case"WW":return i.s(s.isoWeek(),m==="W"?1:2,"0");case"k":case"kk":return i.s(String(s.$H===0?24:s.$H),m==="k"?1:2,"0");case"X":return Math.floor(s.$d.getTime()/1e3);case"x":return s.$d.getTime();case"z":return"["+s.offsetName()+"]";case"zzz":return"["+s.offsetName("long")+"]";default:return m}});return f.bind(this)(c)}}})})(It);var oe=It.exports;const re=pt(oe);var Mt={exports:{}};(function(u,o){(function(t,n){u.exports=n()})(xt,function(){var t,n,r=1e3,f=6e4,a=36e5,s=864e5,e=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=31536e6,c=2628e6,m=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,C={years:i,months:c,days:s,hours:a,minutes:f,seconds:r,milliseconds:1,weeks:6048e5},y=function(w){return w instanceof k},N=function(w,g,l){return new k(w,l,g.$l)},d=function(w){return n.p(w)+"s"},E=function(w){return w<0},x=function(w){return E(w)?Math.ceil(w):Math.floor(w)},S=function(w){return Math.abs(w)},_=function(w,g){return w?E(w)?{negative:!0,format:""+S(w)+g}:{negative:!1,format:""+w+g}:{negative:!1,format:""}},k=function(){function w(l,T,D){var $=this;if(this.$d={},this.$l=D,l===void 0&&(this.$ms=0,this.parseFromMilliseconds()),T)return N(l*C[d(T)],this);if(typeof l=="number")return this.$ms=l,this.parseFromMilliseconds(),this;if(typeof l=="object")return Object.keys(l).forEach(function(z){$.$d[d(z)]=l[z]}),this.calMilliseconds(),this;if(typeof l=="string"){var I=l.match(m);if(I){var A=I.slice(2).map(function(z){return z!=null?Number(z):0});return this.$d.years=A[0],this.$d.months=A[1],this.$d.weeks=A[2],this.$d.days=A[3],this.$d.hours=A[4],this.$d.minutes=A[5],this.$d.seconds=A[6],this.calMilliseconds(),this}}return this}var g=w.prototype;return g.calMilliseconds=function(){var l=this;this.$ms=Object.keys(this.$d).reduce(function(T,D){return T+(l.$d[D]||0)*C[D]},0)},g.parseFromMilliseconds=function(){var l=this.$ms;this.$d.years=x(l/i),l%=i,this.$d.months=x(l/c),l%=c,this.$d.days=x(l/s),l%=s,this.$d.hours=x(l/a),l%=a,this.$d.minutes=x(l/f),l%=f,this.$d.seconds=x(l/r),l%=r,this.$d.milliseconds=l},g.toISOString=function(){var l=_(this.$d.years,"Y"),T=_(this.$d.months,"M"),D=+this.$d.days||0;this.$d.weeks&&(D+=7*this.$d.weeks);var $=_(D,"D"),I=_(this.$d.hours,"H"),A=_(this.$d.minutes,"M"),z=this.$d.seconds||0;this.$d.milliseconds&&(z+=this.$d.milliseconds/1e3,z=Math.round(1e3*z)/1e3);var et=_(z,"S"),rt=l.negative||T.negative||$.negative||I.negative||A.negative||et.negative,q=I.format||A.format||et.format?"T":"",it=(rt?"-":"")+"P"+l.format+T.format+$.format+q+I.format+A.format+et.format;return it==="P"||it==="-P"?"P0D":it},g.toJSON=function(){return this.toISOString()},g.format=function(l){var T=l||"YYYY-MM-DDTHH:mm:ss",D={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return T.replace(e,function($,I){return I||String(D[$])})},g.as=function(l){return this.$ms/C[d(l)]},g.get=function(l){var T=this.$ms,D=d(l);return D==="milliseconds"?T%=1e3:T=D==="weeks"?x(T/C[D]):this.$d[D],T||0},g.add=function(l,T,D){var $;return $=T?l*C[d(T)]:y(l)?l.$ms:N(l,this).$ms,N(this.$ms+$*(D?-1:1),this)},g.subtract=function(l,T){return this.add(l,T,!0)},g.locale=function(l){var T=this.clone();return T.$l=l,T},g.clone=function(){return N(this.$ms,this)},g.humanize=function(l){return t().add(this.$ms,"ms").locale(this.$l).fromNow(!l)},g.valueOf=function(){return this.asMilliseconds()},g.milliseconds=function(){return this.get("milliseconds")},g.asMilliseconds=function(){return this.as("milliseconds")},g.seconds=function(){return this.get("seconds")},g.asSeconds=function(){return this.as("seconds")},g.minutes=function(){return this.get("minutes")},g.asMinutes=function(){return this.as("minutes")},g.hours=function(){return this.get("hours")},g.asHours=function(){return this.as("hours")},g.days=function(){return this.get("days")},g.asDays=function(){return this.as("days")},g.weeks=function(){return this.get("weeks")},g.asWeeks=function(){return this.as("weeks")},g.months=function(){return this.get("months")},g.asMonths=function(){return this.as("months")},g.years=function(){return this.get("years")},g.asYears=function(){return this.as("years")},w}(),B=function(w,g,l){return w.add(g.years()*l,"y").add(g.months()*l,"M").add(g.days()*l,"d").add(g.hours()*l,"h").add(g.minutes()*l,"m").add(g.seconds()*l,"s").add(g.milliseconds()*l,"ms")};return function(w,g,l){t=l,n=l().$utils(),l.duration=function($,I){var A=l.locale();return N($,{$l:A},I)},l.isDuration=y;var T=g.prototype.add,D=g.prototype.subtract;g.prototype.add=function($,I){return y($)?B(this,$,1):T.bind(this)($,I)},g.prototype.subtract=function($,I){return y($)?B(this,$,-1):D.bind(this)($,I)}}})})(Mt);var ie=Mt.exports;const ae=pt(ie);var Ot={exports:{}};(function(u,o){(function(t,n){u.exports=n()})(xt,function(){var t="day";return function(n,r,f){var a=function(i){return i.add(4-i.isoWeekday(),t)},s=r.prototype;s.isoWeekYear=function(){return a(this).year()},s.isoWeek=function(i){if(!this.$utils().u(i))return this.add(7*(i-this.isoWeek()),t);var c,m,C,y,N=a(this),d=(c=this.isoWeekYear(),m=this.$u,C=(m?f.utc:f)().year(c).startOf("year"),y=4-C.isoWeekday(),C.isoWeekday()>4&&(y+=7),C.add(y,t));return N.diff(d,"week")+1},s.isoWeekday=function(i){return this.$utils().u(i)?this.day()||7:this.day(this.day()%7?i:i-7)};var e=s.startOf;s.startOf=function(i,c){var m=this.$utils(),C=!!m.u(c)||c;return m.p(i)==="isoweek"?C?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):e.bind(this)(i,c)}}})})(Ot);var ce=Ot.exports;const le=pt(ce);var jt={exports:{}};(function(u,o){(function(t,n){u.exports=n()})(xt,function(){return function(t,n,r){var f=function(a,s){if(!s||!s.length||s.length===1&&!s[0]||s.length===1&&Array.isArray(s[0])&&!s[0].length)return null;var e;s.length===1&&s[0].length>0&&(s=s[0]),e=(s=s.filter(function(c){return c}))[0];for(var i=1;i<s.length;i+=1)s[i].isValid()&&!s[i][a](e)||(e=s[i]);return e};r.max=function(){var a=[].slice.call(arguments,0);return f("isAfter",a)},r.min=function(){var a=[].slice.call(arguments,0);return f("isBefore",a)}}})})(jt);var de=jt.exports;const ue=pt(de);var Ht={exports:{}};(function(u,o){(function(t,n){u.exports=n()})(xt,function(){var t="minute",n=/[+-]\d\d(?::?\d\d)?/g,r=/([+-]|\d\d)/g;return function(f,a,s){var e=a.prototype;s.utc=function(d){var E={date:d,utc:!0,args:arguments};return new a(E)},e.utc=function(d){var E=s(this.toDate(),{locale:this.$L,utc:!0});return d?E.add(this.utcOffset(),t):E},e.local=function(){return s(this.toDate(),{locale:this.$L,utc:!1})};var i=e.parse;e.parse=function(d){d.utc&&(this.$u=!0),this.$utils().u(d.$offset)||(this.$offset=d.$offset),i.call(this,d)};var c=e.init;e.init=function(){if(this.$u){var d=this.$d;this.$y=d.getUTCFullYear(),this.$M=d.getUTCMonth(),this.$D=d.getUTCDate(),this.$W=d.getUTCDay(),this.$H=d.getUTCHours(),this.$m=d.getUTCMinutes(),this.$s=d.getUTCSeconds(),this.$ms=d.getUTCMilliseconds()}else c.call(this)};var m=e.utcOffset;e.utcOffset=function(d,E){var x=this.$utils().u;if(x(d))return this.$u?0:x(this.$offset)?m.call(this):this.$offset;if(typeof d=="string"&&(d=function(B){B===void 0&&(B="");var w=B.match(n);if(!w)return null;var g=(""+w[0]).match(r)||["-",0,0],l=g[0],T=60*+g[1]+ +g[2];return T===0?0:l==="+"?T:-T}(d),d===null))return this;var S=Math.abs(d)<=16?60*d:d,_=this;if(E)return _.$offset=S,_.$u=d===0,_;if(d!==0){var k=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(_=this.local().add(S+k,t)).$offset=S,_.$x.$localOffset=k}else _=this.utc();return _};var C=e.format;e.format=function(d){var E=d||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return C.call(this,E)},e.valueOf=function(){var d=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*d},e.isUTC=function(){return!!this.$u},e.toISOString=function(){return this.toDate().toISOString()},e.toString=function(){return this.toDate().toUTCString()};var y=e.toDate;e.toDate=function(d){return d==="s"&&this.$offset?s(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():y.call(this)};var N=e.diff;e.diff=function(d,E,x){if(d&&this.$u===d.$u)return N.call(this,d,E,x);var S=this.local(),_=s(d).local();return N.call(S,_,E,x)}}})})(Ht);var he=Ht.exports;const fe=pt(he);G.extend(re);G.extend(Ft);G.extend(ae);G.extend(ue);G.extend(fe);G.extend(le);const st="finish",ot="start",X={LINE_HEIGHT:30,CELL_HEIGHT:36,DND_TYPES:{LINE:"LINE",PROGRESS:"PROGRESS",RESIZE_LEFT:"RESIZE_LEFT",RESIZE_RIGHT:"RESIZE_RIGHT",CONNECT_START:"CONNECT_START",CONNECT_END:"CONNECT_END"}},U={DAY:"day",WEEK:"week",MONTH:"month",YEAR:"year"},Yt={month:{width:50,value:7*24,type:"weeks"},day:{width:50,value:1,type:"hours"},week:{width:70,value:24,type:"days"},year:{width:100,value:31*24,type:"months"}};function nt(u,o,t,n,r,f,a){const s=[];let e=t.clone();for(;n.isSameOrAfter(e);){let i=e.startOf(a||u),c=e.endOf(a||u);i=i.isBefore(t)?t:i,c=c.isAfter(n)?n:c;const m=G.duration(c.diff(i)).asHours(),C=typeof o=="function"?o(e,i,c):`${e.format(o)}`;let y=i.add(1,u);for(;e.isSame(y);)y=y.add(1,u);e=y,s.push({title:C,hours:m,width:Math.round(m*r)})}return s}function ge(u,o,t){const n=Yt[o],r=u.filter(E=>E.startDate),f=r.map(E=>G(E.startDate)),a=r.map(E=>E.endDate?G(E.endDate):G(E.startDate).add(Number(E.duration||0),"h")),s=G.min(f)??G(),e=G.max(a)??G(),i=s.startOf(n.type).subtract(2,n.type),c=e.endOf(n.type).add(2,n.type),m=G.duration(c.diff(i)).asHours();let{width:C,value:y}=n,N=Number(C/y),d=Number((m*N).toFixed(0));return d>0&&d<t&&(N=t/m,C=Math.round(N*y),d=t),{startDate:i,endDate:c,totalWidth:d,hourSize:N,cellWidth:C}}function me(u){const{sx:o,sy:t,ex:n,ey:r,sheight:f,sourceStart:a,targetEnd:s}=u,e=[],i=20;if(a===ot&&s===ot)n<o?(e.push({x:n-i,y:t}),e.push({x:n-i,y:r})):(e.push({x:o-i,y:t}),e.push({x:o-i,y:r}));else if(a===ot&&s===st)if(n<o-20)e.push({x:o-i,y:t}),e.push({x:o-i,y:r<t?r:r+2});else{let c=r<t?t-f/2-5:t+f/2+5;e.push({x:o-i,y:t}),e.push({x:o-i,y:c}),e.push({x:n+i,y:r<t?c+2:c}),e.push({x:n+i,y:r<t?r:r+2})}else a===st&&s===st?o+20<n?(e.push({x:n+i,y:r<t?t+2:t}),e.push({x:n+i,y:r<t?r:r+2})):(e.push({x:o+i,y:r<t?t+2:t}),e.push({x:o+i,y:r<t?r:r+2})):o+20<n?(t>r?e.push({x:o+i,y:t+2}):e.push({x:o+i,y:t}),e.push({x:o+i,y:r})):(t>r?(e.push({x:o+i,y:t+2}),e.push({x:o+i,y:t-f+5/2}),e.push({x:n-i,y:t-f+5/2})):(e.push({x:o+i,y:t}),e.push({x:o+i,y:t+f/2+5}),e.push({x:n-i,y:t+f/2+3})),e.push({x:n-i,y:r}));return e}function xe(u,o,t,n){const r=u.map((a,s)=>{const e=G(a.startDate),i=Number((Number(a.duration)*n).toFixed(0)),c=G.duration(e.diff(o)).asHours(),m=Number((c*n).toFixed(0)),C=X.CELL_HEIGHT*s;return{record:a,height:X.LINE_HEIGHT,width:i,x:m,y:C}},[]);return r.reduce((a,{record:s,x:e,y:i,height:c,width:m},C)=>{const{finishToStart:y,finishToFinish:N,startToStart:d,startToFinish:E}=s;function x(S,_,k){function B(w){const g={x:e,y:i,height:c,width:m},l=r.find(A=>A.record.id===w.id)||g,T=l.x+(_===ot?0:l.width),D=l.y+(l.height+6)/2,$=g.x+(k===st?g.width:0),I=g.y+(g.height+6)/2;return{source:w.id,target:s.id,startPoint:{x:T,y:D},endPoint:{x:$,y:I},bendPoints:me({sx:T,sy:D,ex:$,ey:I,sheight:l.height,sourceStart:_,targetEnd:k}),start:_,end:k}}a.push(...(S||[]).map(B).filter(w=>!!w))}return x(y,st,ot),x(E,ot,st),x(d,ot,ot),x(N,st,st),a},[])}function pe(u,o,t,n){switch(u){case U.WEEK:{const r=nt("day","ddd DD",o,t,n);return[nt("week",(a,s,e)=>`${a.format("W")}(${s.format("DD/MM/YYYY")} - ${e.format("DD/MM/YYYY")})`,o,t,n,"day","isoWeek"),r]}case U.DAY:{const r=nt("hour","HH:00",o,t,n);return[nt("day","DD/MM/YYYY",o,t,n),r]}case U.MONTH:{const r=nt("week","W",o,t,n);return[nt("month","MMMM, YYYY",o,t,n),r]}case U.YEAR:{const r=nt("month","MMM",o,t,n);return[nt("year","YYYY",o,t,n),r]}default:return[]}}function St(u,o,t,n){const{type:r}=Yt[t],f=Number((u/n).toFixed(0));let a=o.clone();return a=a.add(f,r),a.utc().format()}const ye="_gantt_txoxl_1",_e="_root_txoxl_17",ve="_container_txoxl_22",Ee="_header_txoxl_26",Ce="_ganttRows_txoxl_51",we="_ganttRow_txoxl_51",$e="_active_txoxl_60",Te="_highlight_txoxl_64",Ne="_ganttColumn_txoxl_69",De="_ganttColumnTitle_txoxl_76",Re="_ganttEdgeLines_txoxl_89",Se="_ganttEdgeLine_txoxl_89",be="_ganttEdgeIconStart_txoxl_107",ke="_rtl_txoxl_111",Le="_ganttEdgeIconEnd_txoxl_116",Ie="_ganttLine_txoxl_126",Me="_connect_txoxl_136",Oe="_ganttLineProgress_txoxl_140",je="_ganttLineProgressContent_txoxl_144",He="_ganttLineProgressLabel_txoxl_148",Ye="_ganttLineProgressIndicator_txoxl_164",Ae="_ganttLineTitle_txoxl_176",Pe="_ganttLineDrag_txoxl_197",Ge="_left_txoxl_203",We="_right_txoxl_207",Fe="_ganttLineDragArea_txoxl_212",Be="_ganttConnector_txoxl_225",Ue="_ganttConnectorLink_txoxl_242",ze="_show_txoxl_245",Ve="_virtualLine_txoxl_264",Ze="_virtualLineIcon_txoxl_270",Ke="_table_txoxl_281",qe="_tableHeader_txoxl_291",Qe="_tableHeaderCell_txoxl_300",Je="_tableBodyRow_txoxl_313",Xe="_tableBodyRowCell_txoxl_324",tn="_tableBodyRowCellContent_txoxl_336",p={gantt:ye,root:_e,container:ve,header:Ee,ganttRows:Ce,ganttRow:we,active:$e,highlight:Te,ganttColumn:Ne,ganttColumnTitle:De,ganttEdgeLines:Re,ganttEdgeLine:Se,ganttEdgeIconStart:be,rtl:ke,ganttEdgeIconEnd:Le,ganttLine:Ie,connect:Me,ganttLineProgress:Oe,ganttLineProgressContent:je,ganttLineProgressLabel:He,ganttLineProgressIndicator:Ye,ganttLineTitle:Ae,ganttLineDrag:Pe,left:Ge,right:We,ganttLineDragArea:Fe,ganttConnector:Be,ganttConnectorLink:Ue,show:ze,virtualLine:Ve,virtualLineIcon:Ze,table:Ke,tableHeader:qe,tableHeaderCell:Qe,tableBodyRow:Je,tableBodyRowCell:Xe,tableBodyRowCellContent:tn},{DND_TYPES:V}=X,en=Y.memo(function({totalRecords:o,activeRowIndex:t,items:n}){const r=lt(),[f,a]=b.useState([]);b.useEffect(()=>{const e=window.requestIdleCallback(()=>{a(n)});return()=>{window.cancelIdleCallback(e)}},[n]);let s=0;return h.jsxs(h.Fragment,{children:[f.map((e,i)=>{const c={left:s,width:e.width};return s+=e.width,h.jsx("div",{className:p.ganttColumn,style:c,children:h.jsx(K,{color:"secondary",className:p.ganttColumnTitle,children:e.title})},i)}),h.jsx("div",{children:new Array(o).fill(0).map((e,i)=>h.jsx("div",{className:r(p.ganttRow,{[p.active]:t===i})},i))})]})});function nn({totalRecords:u,activeRowIndex:o,children:t,items:n}){const r=Y.useRef(null),{dir:f}=vt(),a=f==="rtl",[,s]=_t({accept:[V.LINE,V.RESIZE_LEFT,V.RESIZE_RIGHT,V.PROGRESS,V.CONNECT_START,V.CONNECT_END],hover:(e,i)=>{const c=i.getItem(),m=i.getSourceClientOffset(),{type:C,refs:y,lineRef:N}=c,d=N?.current;if(!d||!m)return;const E=d.getBoundingClientRect(),x=d.parentElement?.getBoundingClientRect(),S={x:a?E.right-m.x:m.x-E.left,y:m.y-E.top},{element:_}=y.current;switch(C){case V.RESIZE_LEFT:case V.RESIZE_RIGHT:if(x&&m){const D={x:a?x.right-m.x:m.x-x.left,y:m.y-x.top};let $=0;c.type===V.RESIZE_LEFT?(D.x>_.x?$=_.width-Math.abs(D.x-_.x):$=_.width+Math.abs(D.x-_.x),_.width=$>0?$:0,$>0&&(_.x=D.x)):($=D.x-_.x,_.width=$>0?$:0),d&&(d.style[a?"right":"left"]=`${_.x}px`,d.style.width=`${_.width}px`),y.current.element=_}break;case V.PROGRESS:const k=d.querySelector(`.${CSS.escape(p.ganttLineProgress)}`),B=d.querySelector(`.${CSS.escape(p.ganttLineProgressContent)}`),w=d.querySelector(`.${CSS.escape(p.ganttLineProgressLabel)}`),{width:g}=y.current.element,l=Math.max(0,Math.min(g,S.x)),T=Math.max(0,Math.min(100,Math.max(0,l)*100/y.current.element.width));k&&(k.style.width=`${l}px`),B&&(B.style[a?"right":"left"]=`${l}px`),y.current.progress=T.toFixed(2),w&&(w.innerHTML=`${Math.round(T)}%`);break;case V.LINE:x&&(y.current.element={...y.current.element,x:a?x.right-m.x-y.current.element.width:m.x-x.left,y:m.y-x.top},d.style[a?"right":"left"]=`${y.current.element.x}px`);break;case V.CONNECT_START:case V.CONNECT_END:if(x){const D={x:m.x-x.left,y:m.y-x.top,type:C===V.CONNECT_START?"start":"finish"};c.setVirtualLineTarget&&c.setVirtualLineTarget(D)}break}},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})});return s(r),h.jsxs("div",{ref:r,className:p.ganttBody,children:[h.jsx(en,{activeRowIndex:o,items:n,totalRecords:u}),t]})}const sn=Y.memo(function({x1:o,y1:t,x2:n,y2:r,pointer:f,source:a,target:s,targetEnd:e,sourceStart:i,onDeleteConnector:c}){const m=o<n?o:n,C=t<r?t:r,y=o!==n?Math.abs(o-n):0,N=t!==r?Math.abs(t-r):0,{dir:d}=vt(),E=d==="rtl",x=lt(),S=b.useCallback(()=>c&&c({startId:a,finishId:s,source:i,target:e}),[a,s,e,i,c]),_=e==="start";let k;return _?k=E?Dt:Rt:k=E?Rt:Dt,h.jsx(h.Fragment,{children:h.jsx("div",{onDoubleClick:S,className:p.ganttEdgeLine,style:{width:y<=2?0:y,height:N<=2?0:N,top:C,...E?{right:m}:{left:m}},children:f&&h.jsx(Bt,{as:k,className:x(_?p.ganttEdgeIconStart:p.ganttEdgeIconEnd)})})})}),on=Y.memo(u=>{const{edge:o,onDelete:t}=u,{bendPoints:n,startPoint:r,endPoint:f,source:a,target:s,start:e,end:i}=o,c=Y.useMemo(()=>{const m=[];function C(y,N=!1){const d=m.length?m[m.length-1].end:r;d&&m.push({start:d,end:y,pointer:N})}return n&&n.forEach(y=>C(y)),f&&C(f,!0),m},[r,f,n]);return h.jsx("div",{className:p.ganttEdgeLines,children:c.map(({start:m,end:C,pointer:y},N)=>h.jsx(sn,{x1:m.x,y1:m.y,x2:C.x,y2:C.y,pointer:y,onDeleteConnector:t,source:a,target:s,targetEnd:i,sourceStart:e},N))})}),rn=Y.memo(function(o){const{items:t}=o,[n,r]=b.useState([]),f=lt();return b.useEffect(()=>{const a=window.requestIdleCallback(()=>{r(t)});return()=>window.cancelIdleCallback(a)},[t]),h.jsx("div",{children:h.jsx("div",{className:p.header,children:n.map((a,s)=>h.jsx(K,{className:f(p.block,{[p.highlight]:a.highlight}),color:"secondary",style:{minWidth:a.width,maxWidth:a.width},children:a.title},s))})})});function ft(u){u(se(),{captureDraggingState:!0})}const{DND_TYPES:Z}=X;function bt(u,o=1){const t=u.slice(1,3),n=u.slice(3,5),r=u.slice(5,7);return`rgba(${parseInt(t,16)}, ${parseInt(n,16)}, ${parseInt(r,16)}, ${o})`}function an({type:u,x1:o,y1:t,x2:n,y2:r}){const f=Math.sqrt((o-n)*(o-n)+(t-r)*(t-r)),a=(o+n)/2,s=(t+r)/2,e=Math.atan2(r-t,n-o)*180/Math.PI,i=u==="start"?0:10,c=a-f/2+i;return h.jsx("div",{style:{width:f,top:s+10,transform:`rotate(${e}deg)`,left:c},className:p.virtualLine,children:h.jsx(Ut,{icon:"caret-down-fill",className:p.virtualLineIcon})})}const cn=Y.memo(function(o){const t=Y.useRef(null),n=Y.useRef(null),r=Y.useRef(null),f=Y.useRef(null),a=Y.useRef({progress:null,element:null}),[s,e]=Y.useState(null),{dir:i}=vt(),c=i==="rtl",{startDate:m,index:C,hourSize:y,cellSize:N,view:d,config:E,data:x,onUpdate:S,onConnect:_}=o,{id:k,duration:B,$color:w}=x,{progress:g=!0,duration:l=!0,startDate:T=!0,endDate:D=!0}=E||{},{x:$,y:I,width:A}=(()=>{const v=G.duration(G(x.startDate).diff(m)).asHours(),M=Number((Number(B)*y).toFixed(0)),P=X.CELL_HEIGHT*C+(X.CELL_HEIGHT-X.LINE_HEIGHT)/2;return{x:Number((v*y).toFixed(0)),y:P,width:M}})(),z=v=>e({source:v}),et=v=>e(M=>({...M,target:v})),rt=b.useCallback(()=>{const v=a.current.element;return{duration:(v.width/y).toFixed(2),startDate:St(v.x,m,d,N),endDate:St(v.x+v.width,m,d,N)}},[N,y,m,d]),q=(v,M)=>({type:v,item:{id:k,type:v,refs:a,lineRef:t},...M}),[,it,R]=ht(q(Z.LINE,{end:()=>{const v=rt();(T||D)&&S?.(x,{...T&&{startDate:v.startDate},...D&&{endDate:v.endDate}})}})),[,L,j]=ht(q(Z.RESIZE_LEFT,{end:()=>{const v=rt();(T||l)&&S?.(x,{...T&&{startDate:v.startDate},...l&&{duration:v.duration}})}})),[,O,H]=ht(q(Z.RESIZE_RIGHT,{end:()=>{const v=rt();(l||D)&&S?.(x,{...l&&{duration:v.duration},...D&&{endDate:v.endDate}})}})),[,W,F]=ht(q(Z.PROGRESS,{end:()=>{const{progress:v}=a.current;g&&v!==null&&S?.(x,{progress:v}),a.current.progress=null}})),[,Q,dt]=ht({type:Z.CONNECT_START,item:v=>{const M=v.getSourceClientOffset();if(M&&t.current&&t.current.parentElement){const P=t.current.parentElement.getBoundingClientRect(),J={x:M.x-P.left+10,y:M.y-P.top-5,type:"start"};z(J)}return{...q(Z.CONNECT_START).item,setVirtualLineTarget:et}},end:()=>{e(null)}}),[,Et,wt]=ht({type:Z.CONNECT_END,item:v=>{const M=v.getSourceClientOffset();if(M&&t.current&&t.current.parentElement){const P=t.current.parentElement.getBoundingClientRect(),J={x:M.x-P.left-5,y:M.y-P.top-5,type:"finish"};z(J)}return{...q(Z.CONNECT_END).item,setVirtualLineTarget:et}},end:()=>{e(null)}}),[Ct,Pt]=_t({accept:[Z.CONNECT_START,Z.CONNECT_END],drop:(v,M)=>{const P=M.getItem(),J={startId:P.id,finishId:k,source:P.type==="CONNECT_START"?"start":"finish",target:"start"};!P.connect&&_&&_(J)},canDrop:(v,M)=>M.getItem().id!==x.id,collect:v=>({isOver:v.isOver(),canDrop:v.canDrop()})}),[$t,Gt]=_t({accept:[Z.CONNECT_START,Z.CONNECT_END],drop:(v,M)=>{const P=M.getItem(),J={startId:P.id,finishId:k,source:P.type==="CONNECT_START"?"start":"finish",target:"start"};P.connect=!0,_&&_(J)},canDrop:(v,M)=>M.getItem().id!==x.id,collect:v=>({isOver:v.isOver(),canDrop:v.canDrop()})}),[Tt,Wt]=_t({accept:[Z.CONNECT_START,Z.CONNECT_END],drop:(v,M)=>{const P=M.getItem(),J={startId:P.id,finishId:k,source:P.type==="CONNECT_START"?"start":"finish",target:"finish"};P.connect=!0,_&&_(J)},canDrop:(v,M)=>M.getItem().id!==x.id,collect:v=>({isOver:v.isOver(),canDrop:v.canDrop()})}),ut=Number(x.progress||0),Nt=Number(ut*Number(B||0))/100*y;Y.useEffect(()=>{ft(F),ft(j),ft(H),ft(R),ft(dt),ft(wt)},[F,j,H,R,dt,wt]),Pt(it(t)),Gt(Q(n)),Wt(Et(r)),Y.useEffect(()=>{a.current.element={x:$,y:I,width:A}},[$,I,A]),Y.useEffect(()=>{const v=t.current;v&&(v.style[c?"right":"left"]=`${$}px`,v.style.top=`${I}px`)},[$,I,x,c]);const at=lt();return h.jsxs(h.Fragment,{children:[h.jsxs("div",{ref:t,className:at(p.ganttLine,{[p.connect]:Ct.isOver}),style:{top:I,position:"absolute",width:A,height:X.LINE_HEIGHT,...c?{right:$}:{left:$},...w?{"--gantt-line-bg":bt(w,.75),"--gantt-progress-color":bt(w,1)}:{}},children:[g&&h.jsx("div",{ref:f,className:p.ganttLineProgress,style:{height:X.LINE_HEIGHT,width:`${ut}%`},children:h.jsx("div",{className:p.ganttLineProgressContent,style:{...c?{right:`${ut}%`}:{left:`${ut}%`}},children:h.jsx("div",{className:p.ganttLineProgressLabel,children:`${ut>0?Math.round(ut):"0"}%`})})}),h.jsx("div",{ref:n,className:at(p.ganttConnector,{[p.left]:!c,[p.right]:c,[p.show]:$t.isOver||Ct.isOver||s&&s.source?.type==="start",[p.connect]:$t.isOver}),children:h.jsx("div",{className:p.ganttConnectorLink})}),h.jsx("div",{className:at(p.ganttLineDragArea,{[p.left]:!c,[p.right]:c})}),h.jsx("div",{ref:L,className:at(p.ganttLineDrag,{[p.left]:!c,[p.right]:c})}),h.jsx("div",{ref:r,className:at(p.ganttConnector,{[p.left]:c,[p.right]:!c,[p.show]:Tt.isOver||Ct.isOver||s&&s.source?.type==="finish",[p.connect]:Tt.isOver}),children:h.jsx("div",{className:p.ganttConnectorLink})}),h.jsx("div",{className:at(p.ganttLineDragArea,{[p.left]:c,[p.right]:!c})}),h.jsx("div",{ref:O,className:at(p.ganttLineDrag,{[p.left]:c,[p.right]:!c})}),h.jsx("div",{className:p.ganttLineTitle,children:h.jsx("span",{children:x.name})}),g&&h.jsx("div",{ref:W,className:p.ganttLineProgressIndicator,style:{[c?"right":"left"]:Math.min(A-10,Math.max(0,Nt-(Nt>5?5:0)))}})]}),s&&s.source&&s.target&&h.jsx(an,{type:s.source.type,x1:s.source.x,y1:s.source.y,x2:s.target.x,y2:s.target.y})]})});function At({field:u,...o}){return h.jsx("div",{...u.width&&{style:{minWidth:u.width,maxWidth:u.width}},...o})}const ln=Y.memo(function({items:o}){return h.jsx("div",{className:p.tableHeader,children:o.map(t=>h.jsx(At,{field:t,className:p.tableHeaderCell,children:t.title},t.name))})}),dn=Y.memo(function({active:o,onClick:t,onView:n,index:r,items:f,data:a}){const s=lt();return h.jsx("div",{className:s(p.tableBodyRow,{[p.active]:o}),onClick:e=>t(a.id),onDoubleClick:()=>n?.(a,r),children:f.map(e=>{const i=a[e.name],c=e.formatter?e.formatter(e,a[e.name],a):i;function m(){const C=e.renderer;return h.jsx(C,{field:e,data:a,value:c})}return h.jsx(At,{field:e,className:p.tableBodyRowCell,children:h.jsx("div",{className:p.tableBodyRowCellContent,children:e.renderer?m():c})},e.name)})})});function un(u){const{items:o,records:t,activeRow:n,setActiveRow:r,onView:f}=u,a=lt();return h.jsxs(K,{className:a("table-grid",p.table),children:[h.jsx(ln,{items:o}),h.jsx("div",{className:p.tableBody,children:t.map((s,e)=>h.jsx(dn,{index:e,items:o,data:s,active:String(n)===String(s.id),onView:f,onClick:r},e))})]})}function hn(u){const{view:o,config:t,records:n,activeRowIndex:r,startDate:f,cellSize:a,hourSize:s,endDate:e,onRecordUpdate:i,onRecordConnect:c,onRecordDisconnect:m}=u,[C,y]=b.useState([]),[N,d]=b.useState([]),E=Y.useMemo(()=>xe(n,f,e,s),[n,f,e,s]);return b.useEffect(()=>{const x=window.requestIdleCallback(()=>{const[S,_]=pe(o,f,e,s);y(S),d(_)});return()=>{window.cancelIdleCallback(x)}},[o,f,e,s]),h.jsxs("div",{className:p.body,children:[h.jsx(rn,{items:C}),h.jsxs("div",{className:p.ganttRows,children:[h.jsx(nn,{items:N,activeRowIndex:r,totalRecords:n.length,children:n.map((x,S)=>h.jsx(cn,{index:S,view:o,config:t,startDate:f,endDate:e,hourSize:s,cellSize:a,data:x,onUpdate:i,onConnect:c},S))}),E.map((x,S)=>h.jsx(on,{edge:x,onDelete:m},S))]})]})}function fn({className:u,records:o,view:t,items:n,config:r,onRecordView:f,onRecordUpdate:a,onRecordConnect:s,onRecordDisconnect:e}){const[i,c]=Y.useState(null),[m,C]=Y.useState(null),{dir:y}=vt(),N=y==="rtl",d=lt(),E=Y.useMemo(()=>i&&ge(o,t,i.offsetWidth),[i,o,t]),x=E?.startDate.format(),S=E?.endDate.format(),[_,k]=Y.useMemo(()=>[x&&G(x),S&&G(S)],[x,S]);function B(){if(i){const g=i.previousSibling,{scrollTop:l}=i;g&&l>=0&&(g.scrollTop=l)}}const w=b.useMemo(()=>o.findIndex(g=>g.id===m),[o,m]);return h.jsxs(K,{d:"flex",className:d(p.gantt,u,p.root,{[p.rtl]:N}),children:[h.jsx(un,{items:n,records:o,activeRow:m,setActiveRow:C,onView:f}),h.jsx(K,{ref:c,flex:"1",className:p.container,onScroll:B,children:E&&_&&k&&h.jsx("div",{className:p.gantt,style:{width:E.totalWidth},children:h.jsx(hn,{view:t,config:r,hourSize:E.hourSize,cellSize:E.cellWidth,startDate:_,endDate:k,activeRowIndex:w,records:o,onRecordConnect:s,onRecordDisconnect:e,onRecordUpdate:a})})})]})}const gn={taskDuration:1,startToStart:[],startToFinish:[],finishToStart:[],finishToFinish:[]},gt={taskParent:"parent",taskStart:"startDate",taskEnd:"endDate",taskDuration:"duration",taskProgress:"progress",taskSequence:"sequence",startToStart:"startToStart",startToFinish:"startToFinish",finishToStart:"finishToStart",finishToFinish:"finishToFinish"};function mn(u,o){const t={data:o};u.taskUser&&o[u.taskUser]&&(t.$color=ne(o[u.taskUser].id));const n=Object.keys(gt).reduce((r,f)=>{const a=u[f];return a?{...r,[gt[f]]:o[a]??gn[f]}:r},t);return{...Lt(o,Object.keys(gt).map(r=>u[r])),...n}}function xn(u,o){const t=Object.values(gt);return{...Lt(o,[...t,"data","$color"]),...Object.keys(gt).reduce((n,r)=>{const f=u[r];if(f){const a=gt[r];return{...n,[f]:o[a]}}return n},{})}}const pn="_container_1y1kf_1",yn="_cell_1y1kf_9",_n="_icon_1y1kf_13",tt={container:pn,cell:yn,icon:_n},kt={start_finish:"startToFinish",finish_finish:"finishToFinish",start_start:"startToStart",finish_start:"finishToStart"};function vn({value:u,data:o,onExpand:t}){const{_level:n,_children:r,_expand:f=!0}=o,a=!!r?.length;return h.jsxs(K,{d:"flex",alignItems:"center",className:tt.cell,gap:4,...n&&{style:{paddingLeft:`${(n-1)*.75}rem`}},...a&&{fontWeight:"bold"},children:[h.jsxs(K,{d:"flex",children:[a?h.jsx(mt,{className:tt.icon,icon:f?"arrow_drop_down":"arrow_right",onClick:()=>t?.(o,!f)}):h.jsx(K,{style:{width:20}}),h.jsx(mt,{className:tt.icon,icon:a?"folder_open":"description",fontSize:a?"1.5rem":"1.4rem"})]}),h.jsx(K,{as:"span",children:u})]})}function En({data:u,onAdd:o,onRemove:t}){return h.jsxs(K,{d:"flex",className:tt.cell,children:[h.jsx(mt,{className:tt.icon,icon:"add",fontSize:"1.3rem",onClick:()=>o?.(u)}),h.jsx(mt,{className:tt.icon,icon:"close",fontSize:"1.3rem",onClick:()=>t?.(u)})]})}function Cn(u,o,t){return te(o,{props:u,context:t})}function Nn({dataStore:u,meta:o}){const[t,n]=b.useState(U.WEEK),[r,f]=b.useState([]),{action:a,dashlet:s}=zt(),e=Vt(a,s),{fields:i,view:c}=o,{items:m}=c,{domain:C,context:y}=a,{formatter:N,transformer:d}=b.useMemo(()=>({formatter:R=>mn(c,R),transformer:R=>xn(c,R)}),[c]),E=b.useCallback((R,L)=>f(j=>j.map(O=>O.id===R.id?{...O,_expand:L}:O)),[]),x=b.useCallback(async R=>{const{records:L}=await u.search({...R,filter:{_domain:C||void 0,_domainContext:y}});f(L)},[u,C,y]),S=b.useCallback(async R=>{const L=d(R),j=await u.save(L);j&&f(O=>O.map(H=>H.id===L.id?{...H,...N(j)}:H))},[d,N,u]),_=b.useCallback(({startId:R,finishId:L,source:j,target:O})=>{const H=kt[`${j}_${O}`],W=r.find(F=>F.id===L);if(W){const F=W[H]||[];if(!F?.find(Q=>String(Q.id)===String(R)))return S({...W,[H]:[...F,{id:R}]})}},[r,S]),k=b.useCallback(({startId:R,finishId:L,source:j,target:O})=>{const H=kt[`${j}_${O}`],W=r.find(F=>F.id===L);if(W){const F=W[H]||[];return S({...W,[H]:F?.filter(Q=>String(Q.id)!==String(R))})}},[r,S]),B=b.useCallback((R,L)=>S({id:R.id,version:R.version,...L}),[S]),w=b.useCallback(async R=>{if(await Zt.confirm({content:ct.get("Do you really want to delete the selected task?"),yesTitle:ct.get("Delete")})){const{id:j,version:O}=R;j&&await u.delete({id:j,version:O??0})&&f(W=>W.filter(F=>F.id!==j))}},[u]),g=b.useCallback(R=>{const{model:L,title:j}=c,O=!R.id;L&&e({title:j??"",model:L,record:R,readonly:!1,onSelect:H=>{f(W=>O?[...W,H]:W.map(F=>F.id===H.id?{...F,...H}:F))}})},[c,e]),l=b.useCallback(async R=>{const{taskParent:L,taskDuration:j,taskProgress:O,taskStart:H}=c;g({...H&&{[H]:Kt().format("YYYY-MM-DDTHH:mm:ss[Z]")},...j&&{[j]:1},...O&&{[O]:0},...L&&R&&{[L]:{id:R.id,version:R.version,name:R.name}}})},[c,g]);b.useEffect(()=>{x()},[x]),b.useEffect(()=>u.subscribe(()=>{f(u.records)}),[u]);const{page:T}=u,{offset:D=0,limit:$=ee,totalCount:I=0}=T,A=D>0,z=D+$<I,et=b.useMemo(()=>(m||[]).concat(c.taskUser?[{type:"field",name:c.taskUser}]:[]).map((R,L)=>({...L===0&&{width:160,renderer:j=>h.jsx(vn,{...j,onExpand:E})},...R,...i?.[R.name],formatter:Cn})).concat([{title:h.jsx(K,{d:"flex",children:h.jsx(mt,{className:tt.icon,icon:"add",onClick:()=>l()})}),name:"$actions",renderer:R=>h.jsx(En,{...R,onAdd:l,onRemove:w}),width:60}]),[c,m,i,E,l,w]),rt=b.useMemo(()=>{const R=O=>O[c.taskParent];function L(O,H=1){return r.filter(W=>W[c.taskStart]&&(O?(R(W)||{}).id===O:R(W)===O)).reduce((W,F)=>{const Q={...F,_level:H},dt=L(Q.id,H+1);return W.concat([dt.length?{...Q,_children:dt.map(Et=>Et.id)}:Q,...Q._expand===!1?[]:dt])},[])}return L(null).map(N)},[c,N,r]);qt("gantt",x);const q=b.useMemo(()=>[{key:U.YEAR,text:ct.get("Year"),iconOnly:!1,checked:t===U.YEAR,onClick:()=>n(U.YEAR)},{key:U.MONTH,text:ct.get("Month"),iconOnly:!1,checked:t===U.MONTH,onClick:()=>n(U.MONTH)},{key:U.WEEK,text:ct.get("Week"),iconOnly:!1,checked:t===U.WEEK,onClick:()=>n(U.WEEK)},{key:U.DAY,text:ct.get("Day"),iconOnly:!1,checked:t===U.DAY,onClick:()=>n(U.DAY)},{key:"d1",divider:!0},{key:"refresh",text:ct.get("Refresh"),iconOnly:!1,onClick:()=>x()}],[x,t]),it=b.useMemo(()=>({progress:!!c.taskProgress,duration:!!c.taskDuration,startDate:!!c.taskStart,endDate:!!c.taskEnd}),[c]);return h.jsxs(K,{d:"flex",className:tt.container,flex:1,flexDirection:"column",children:[h.jsx(Qt,{meta:o,actions:q,pagination:{canPrev:A,canNext:z,onPrev:()=>x({offset:D-$}),onNext:()=>x({offset:D+$}),text:()=>h.jsx(Jt,{dataStore:u})}}),h.jsx(K,{d:"flex",flex:1,overflow:"auto",px:1,children:h.jsx(Xt,{children:h.jsx(fn,{className:tt.gantt,view:t,config:it,items:et,records:rt,onRecordView:g,onRecordConnect:_,onRecordDisconnect:k,onRecordUpdate:B})})})]})}export{Nn as Gantt};
