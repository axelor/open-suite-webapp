import{r as o,D as h,j as a,B as _,E as de,O as me,h as ue,P as he,Q as pe,i as fe,S as we,T as xe,U,V as Ce,q as ye,W as _e,X as ke,Y as ge,Z as be,H as ve,k as Z,_ as Se,n as Ae,$ as Te,v as Ne,z as je,a0 as Ee,a1 as Pe,a2 as Be,a3 as De}from"./index-DXMBB59R.js";import{u as Ie}from"./use-search-translate-B3pGj8Xc.js";import{u as Ve,C as He}from"./use-card-classname-CY1KI0TO.js";const We="_card_1ch0h_1",Oe="_menuIcon_1ch0h_7",Re="_cardContent_1ch0h_24",I={card:We,menuIcon:Oe,cardContent:Re},qe=o.memo(function({record:i,fields:s,view:r,onEdit:e,onView:p,onDelete:n,onRefresh:d,Template:T,width:E,minWidth:N}){const f=Ve(r,i);function w(){p?.(i)}const k=[{key:"menu",iconProps:{icon:"arrow_drop_down"},items:[{key:"edit",text:h.get("Edit"),hidden:!e,onClick:()=>e?.(i)},{key:"delete",text:h.get("Delete"),hidden:!n,onClick:()=>n?.(i)}]}],x=e||n;return a.jsx(a.Fragment,{children:a.jsxs(_,{d:"flex",px:{base:1,md:2},mb:{base:2,md:3},className:I.card,style:{width:E,minWidth:N},children:[a.jsx(_,{className:de(I.cardContent,f),p:{base:2,md:3},bgColor:"body",w:100,rounded:!0,shadow:"sm",onClick:w,children:a.jsx(He,{component:T,record:i,fields:s,onRefresh:d})}),x&&a.jsx(me,{className:I.menuIcon,items:k})]})})}),Me="_container_12ro9_1",ze="_cards_12ro9_9",G={container:Me,cards:ze};function Ge(V){const{meta:i,dataStore:s,searchAtom:r}=V,{view:e,fields:p}=i,{action:n,dashlet:d,popup:T,popupOptions:E}=ue(),N=he(),{hasButton:f}=pe(i.view,i.perms),w=fe(),{onDelete:k}=e,x=d||e.editWindow==="popup",H=x||e.editWindow==="popup-new",W=we(n,d),O=o.useCallback(()=>({...w(!0),_model:n.model}),[n.model,w]),L=o.useCallback(()=>({...O(),_viewName:n.name,_viewType:n.viewType,_views:n.views}),[n.name,n.viewType,n.views,O]),{width:Q,minWidth:X}=o.useMemo(()=>{const l=(e.width||"calc(100% / 3)").split(":").map(m=>m.trim()).filter(Boolean);return{width:l[0],minWidth:l[1]}},[e.width]),P=o.useMemo(()=>xe(e.orderBy),[e.orderBy]),R=Ie(P,p),B=U(o.useCallback((t,l,m={})=>{const A=Ce(P),j=Object.keys(p??{});let{query:u={}}=r?t(r):{};if(d){const{_domainAction:re,...ie}=w()??{},le={...u._domainContext,...ie};u={...u,_domainAction:re,_domainContext:le}}const ce=R(u);return s.search({translate:ce,sortBy:A,filter:u,fields:j,...m})},[P,r,p,d,s,R,w])),c=ye(B),g=o.useCallback(()=>B({}),[B]),b=_e(e,{getContext:L,onRefresh:g}),Y=U(o.useCallback(t=>{const{query:l={}}=r?t(r):{};return{...s.options?.filter,...l}},[s,r])),D=ke(s,t=>t.records),$=ge(e.template);be(async()=>{await c()},[c]);const J=o.useCallback(async t=>{if(await ve.confirm({content:h.get("Do you really want to delete the selected record(s)?"),yesTitle:h.get("Delete")})){k&&await b.execute(k,{context:t});try{await s.delete([{id:t.id,version:t.version}])}catch{}}},[k,b,s]),C=o.useCallback((t,l=!1)=>{const m=t.id||0,A=m>0?String(m):"";N("form",{route:{id:A},props:{readonly:l}})},[N]),v=o.useCallback((t,l=!1)=>{const m=n.views?.find(u=>u.type==="form")?.name,{title:A,model:j}=e;j&&W({title:A??"",model:j,viewName:m,record:t,readonly:l,onSearch:()=>c({})})},[W,e,n,c]),q=o.useCallback(()=>{H?v({}):C({})},[H,C,v]),K=o.useCallback(t=>{x?v(t,!0):C(t,!0)},[x,C,v]),M=Z(Se()),z=Z(Ae());o.useEffect(()=>{T&&M({dataStore:s,onSearch:c})},[c,T,s,M]),o.useEffect(()=>{d&&z({searchAtom:r,dataStore:s,actionExecutor:b,view:e,onRefresh:g})},[d,e,r,s,b,g,z]);const ee=E?.showToolbar!==!1,{offset:y=0,limit:S=De,totalCount:te=0}=s.page,se=y>0,oe=y+S<te,F=f("new"),ne=o.useCallback(()=>c({offset:y-S}),[S,y,c]),ae=o.useCallback(()=>c({offset:y+S}),[S,y,c]);return Te({viewType:e.type,onNew:F?q:void 0,onRefresh:g}),Ne("cards",c),a.jsxs(_,{className:je(G.container,"cards-view","row-fluid"),children:[ee&&a.jsx(Ee,{meta:i,dataStore:s,getActionData:Y,actionExecutor:b,actions:[{key:"new",text:h.get("New"),hidden:!F,iconProps:{icon:"add"},onClick:q},{key:"refresh",text:h.get("Refresh"),iconProps:{icon:"refresh"},onClick:()=>c()}],pagination:{canPrev:se,canNext:oe,onPrev:ne,onNext:ae,text:()=>a.jsx(Pe,{dataStore:s})},children:r&&a.jsx(Be,{stateAtom:r,dataStore:s,items:e.items,customSearch:e.customSearch,freeSearch:e.freeSearch,onSearch:c})}),D.length>0&&a.jsx(_,{className:G.cards,children:D.map(t=>a.jsx(qe,{record:t,fields:p,view:e,onView:K,Template:$,width:Q,minWidth:X,onRefresh:g,...f("edit")&&{onEdit:C},...f("edit")&&{onEdit:x?v:C},...f("delete")&&{onDelete:J}},t.id))}),D.length===0&&a.jsx(_,{d:"flex",flex:1,justifyContent:"center",alignItems:"center",children:a.jsx(_,{style:{fontSize:"0.9rem"},children:h.get("No records found.")})})]})}export{Ge as Cards};
